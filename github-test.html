<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub設定テスト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>GitHub設定機能テスト</h1>
        
        <div class="buttons">
            <button onclick="testGitHubSetup()">GitHub設定画面テスト</button>
            <button onclick="testShowRanking()">ランキング表示テスト</button>
            <button onclick="clearLog()">ログクリア</button>
        </div>
        
        <div id="log" class="log">テスト開始...\n</div>
    </div>

    <!-- GitHub連携用設定とランキングシステム -->
    <script src="github-config.js"></script>
    <script src="github-ranking.js"></script>
    
    <!-- テスト用のランキングオーバーレイスタイル -->
    <style>
        .github-setup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .github-setup {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            color: white;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        .token-input input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }
        .save-token-btn, .close-setup-btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            background: #28a745;
            color: white;
        }
    </style>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').textContent = 'ログクリア...\n';
        }
        
        function testGitHubSetup() {
            log('GitHub設定画面テスト開始');
            
            try {
                // GitHub関数の可用性をチェック
                log('getGitHubToken: ' + (typeof getGitHubToken));
                log('setGitHubToken: ' + (typeof setGitHubToken));
                log('GITHUB_CONFIG: ' + (typeof GITHUB_CONFIG));
                
                // 簡易設定画面を表示
                let setupHTML = '<div class="github-setup">';
                setupHTML += '<h3>⚙️ GitHub設定テスト</h3>';
                setupHTML += '<div class="token-input">';
                setupHTML += '<input type="password" id="github-token" placeholder="トークンを入力">';
                setupHTML += '<button onclick="saveTestToken()" class="save-token-btn">保存</button>';
                setupHTML += '</div>';
                setupHTML += '<button onclick="closeTestSetup()" class="close-setup-btn">閉じる</button>';
                setupHTML += '</div>';
                
                const overlay = document.createElement('div');
                overlay.className = 'github-setup-overlay';
                overlay.innerHTML = setupHTML;
                document.body.appendChild(overlay);
                
                log('GitHub設定画面を表示しました');
                
            } catch (error) {
                log('エラー: ' + error.message);
            }
        }
        
        function saveTestToken() {
            const tokenInput = document.getElementById('github-token');
            const token = tokenInput.value.trim();
            
            log('トークン入力値: ' + (token ? '***入力あり***' : '空'));
            
            if (token) {
                if (typeof setGitHubToken === 'function') {
                    setGitHubToken(token);
                    log('setGitHubToken関数でトークンを保存');
                } else {
                    localStorage.setItem('github_token', token);
                    log('localStorageに直接保存');
                }
                alert('トークンを保存しました');
                closeTestSetup();
            } else {
                alert('トークンを入力してください');
            }
        }
        
        function closeTestSetup() {
            const overlay = document.querySelector('.github-setup-overlay');
            if (overlay) {
                document.body.removeChild(overlay);
                log('GitHub設定画面を閉じました');
            }
        }
        
        function testShowRanking() {
            log('ランキング表示テスト（未実装）');
        }
        
        // 初期化
        window.addEventListener('load', function() {
            log('ページロード完了');
            log('利用可能な関数をチェック中...');
            
            setTimeout(() => {
                log('getGitHubToken: ' + (typeof getGitHubToken));
                log('setGitHubToken: ' + (typeof setGitHubToken));
                log('clearGitHubToken: ' + (typeof clearGitHubToken));
                log('GITHUB_CONFIG: ' + (typeof GITHUB_CONFIG));
                log('githubRanking: ' + (typeof githubRanking));
            }, 1000);
        });
    </script>
</body>
</html>