<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-area { max-width: 600px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .ranking-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .ranking-display {
            background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%;
            max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        .ranking-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .ranking-table th, .ranking-table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        .ranking-table th { background-color: #f8f9fa; font-weight: bold; }
        .close-ranking-btn { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="test-area">
        <h1>ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        
        <button onclick="testShowRanking()">ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</button>
        <button onclick="createTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
        <button onclick="clearTestData()">ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
        <button onclick="checkLocalStorage()">LocalStorageç¢ºèª</button>
        
        <div id="status"></div>
    </div>

    <script>
        function log(message) {
            document.getElementById('status').innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
        }
        
        function testShowRanking() {
            log('ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                const localData = JSON.parse(localStorage.getItem('gameRanking')) || { rankings: [] };
                log('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—: ' + localData.rankings.length + 'ä»¶');
                
                let rankingHTML = '<div class="ranking-display">';
                rankingHTML += '<h2>ğŸ† ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>';
                
                if (localData.rankings.length === 0) {
                    rankingHTML += '<p>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                } else {
                    rankingHTML += '<table class="ranking-table">';
                    rankingHTML += '<thead><tr><th>é †ä½</th><th>åå‰</th><th>æ™‚é–“</th><th>æ­£è§£ç‡</th><th>æ—¥æ™‚</th></tr></thead>';
                    rankingHTML += '<tbody>';
                    
                    localData.rankings.slice(0, 10).forEach((ranking, index) => {
                        const playDate = new Date(ranking.playDate).toLocaleDateString('ja-JP');
                        rankingHTML += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${ranking.playerName}</td>
                                <td>${ranking.finalScore.toFixed(2)}ç§’</td>
                                <td>${ranking.accuracy.toFixed(1)}%</td>
                                <td>${playDate}</td>
                            </tr>
                        `;
                    });
                    
                    rankingHTML += '</tbody></table>';
                }
                
                rankingHTML += '<button onclick="closeTestRanking()" class="close-ranking-btn">é–‰ã˜ã‚‹</button>';
                rankingHTML += '</div>';
                
                const overlay = document.createElement('div');
                overlay.className = 'ranking-overlay';
                overlay.innerHTML = rankingHTML;
                document.body.appendChild(overlay);
                
                log('ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºæˆåŠŸ');
                
            } catch (error) {
                log('ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }
        
        function closeTestRanking() {
            const overlay = document.querySelector('.ranking-overlay');
            if (overlay) {
                document.body.removeChild(overlay);
                log('ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”»é¢ã‚’é–‰ã˜ã¾ã—ãŸ');
            }
        }
        
        function createTestData() {
            const testData = {
                rankings: [
                    {
                        id: Date.now(),
                        playerName: 'ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1',
                        finalScore: 25.50,
                        accuracy: 95.0,
                        wrongClicks: 1,
                        playDate: new Date().toISOString()
                    },
                    {
                        id: Date.now() + 1,
                        playerName: 'ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2',
                        finalScore: 30.25,
                        accuracy: 90.5,
                        wrongClicks: 2,
                        playDate: new Date().toISOString()
                    }
                ],
                lastUpdated: new Date().toISOString(),
                totalPlayers: 2
            };
            
            localStorage.setItem('gameRanking', JSON.stringify(testData));
            log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ');
        }
        
        function clearTestData() {
            localStorage.removeItem('gameRanking');
            log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
        
        function checkLocalStorage() {
            const data = localStorage.getItem('gameRanking');
            if (data) {
                const parsed = JSON.parse(data);
                log('LocalStorage: ' + parsed.rankings.length + 'ä»¶ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°');
            } else {
                log('LocalStorage: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãªã—');
            }
        }
        
        // åˆæœŸåŒ–
        log('ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
    </script>
</body>
</html>